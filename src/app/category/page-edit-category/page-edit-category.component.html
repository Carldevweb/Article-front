<div class="container py-4">
    <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
            <h3 class="mb-1">Modifier une catégorie</h3>
        </div>

        <button class="btn btn-outline-secondary" type="button" (click)="onBack()">
            Retour
        </button>
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger mb-3">
        {{ errorMessage }}
    </div>

    <div *ngIf="successMessage" class="alert alert-success mb-3">
        {{ successMessage }}
    </div>

    <div *ngIf="loading" class="py-5 text-center">
        <span class="spinner-border" role="status" aria-hidden="true"></span>
    </div>

    <div *ngIf="!loading" class="row g-4">
        <!-- LEFT: Preview -->
        <div class="col-12 col-lg-5">
            <div class="cat-panel">
                <div class="cat-panel__title mb-3">Aperçu</div>

                <div class="ratio ratio-16x9 cat-preview">
                    <img [src]="getPreviewSrc()" alt="Aperçu image catégorie" />
                </div>

                <div class="mt-3 d-flex gap-2">
                    <label class="btn cat-btn-outline w-100 mb-0" [class.disabled]="saving"
                        (click)="saving ? $event.preventDefault() : null" style="cursor: pointer;">
                        Choisir un fichier
                        <input type="file" accept="image/*" class="d-none" (change)="onFileSelected($event)" />
                    </label>

                    <button class="btn cat-btn-outline w-100" type="button" (click)="removeSelectedFile()"
                        [disabled]="saving || !selectedFile">
                        Retirer
                    </button>
                </div>

                <div class="text-muted mt-2" style="font-size: .9rem;">
                    Recadrage automatique en 16:9 à l’affichage. Max 5MB.
                </div>
            </div>
        </div>

        <!-- RIGHT: Form -->
        <div class="col-12 col-lg-7">
            <div class="cat-panel">
                <div class="cat-panel__title mb-3">Informations</div>

                <form [formGroup]="form" (ngSubmit)="save()">
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Nom de la catégorie</label>
                        <input class="form-control cat-input" type="text" formControlName="nomCategorie"
                            placeholder="Ex: Java, Angular..." [disabled]="saving" />
                        <div class="text-danger mt-1" *ngIf="f['nomCategorie'].touched && f['nomCategorie'].invalid">
                            Nom requis (min 2 caractères).
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold">Image URL (optionnel)</label>
                        <input class="form-control cat-input" type="url" formControlName="imageUrl"
                            placeholder="https://..." [disabled]="saving" />
                        <div class="form-text">
                            Si tu upload un fichier, l’image uploadée doit être celle prise en compte côté backend.
                        </div>
                    </div>

                    <button class="btn cat-btn-primary w-100" type="submit" [disabled]="saving">
                        <span *ngIf="saving" class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
                        Enregistrer
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>